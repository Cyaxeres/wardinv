extends layouts/main

append head
  title Order | CM

block content
  nav.navbar.navbar-expand-sm.navbar-light
    a.navbar-brand(href='/products')
      img(src="/assets/resources/img/cmlogo.svg", alt="Cabinet Manager Logo", width="50px")
    button.navbar-toggler.hidden-lg-up(type='button', data-toggle='collapse', data-target='#collapsibleNavId', aria-controls='collapsibleNavId', aria-expanded='false', aria-label='Toggle navigation')
    #collapsibleNavId.collapse.navbar-collapse
      ul.navbar-nav.mr-auto.mt-2.mt-lg-0
        li.nav-item.active
          a.nav-link(href='/products') Products
          span.sr-only (current)
        li.nav-item
          a.nav-link(href='#') Link
        li.nav-item.dropdown
          a#dropdownId.nav-link.dropdown-toggle(href='#', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false') Dropdown
          .dropdown-menu(aria-labelledby='dropdownId')
            a.dropdown-item(href='#') Action 1
            a.dropdown-item(href='#') Action 2
      //- form.form-inline.my-2.my-lg-0
      //-     input.form-control.mr-sm-2(type='text', placeholder='Search')
      //-     button.btn.btn-outline-success.my-2.my-sm-0(type='submit') Search
      if (session.user)
        p.my-2 Logged in as #{session.user.name}

  div.container-fluid.section
    .row
      .col-md-2
      .col-md-8
        if error && error.length > 0 
          .alert.alert-warning.alert-dismissible.fade.show(role='alert')
            strong Oops!
            |  #{error}
            button.close(type='button', data-dismiss='alert', aria-label='Close')
              span(aria-hidden='true') ×
        if success && success.length > 0
          .alert.alert-success.alert-dismissible.fade.show(role='alert')
            strong Success!
            |  #{success}
            button.close(type='button', data-dismiss='alert', aria-label='Close')
              span(aria-hidden='true') ×

        .header-section.d-flex.justify-content-between.mb-4.align-items-center
          h1.display-4.mb-0 Order Details
          h3
            if order.active
              span.badge.badge-danger Not delivered
            else
              span.badge.badge-success Delivered

          //- .btn-group.float-right
          //-     a.btn.btn-outline-primary.mr-3(href="/products/new") All Products
          //-     a.btn.btn-outline-info.mr-3(href="/orders") All Orders
          //-     if cart && cart.totalQty > 0  
          //-         a.btn.btn-secondary(href="/cart") Cart #[span.badge.badge-light #{cart.totalQty}]
        hr
        .order__details.container
          .row
            .col-md-4
              .order__detail.mb-2.text-center
                p.mb-1.order__part--title ORDER ID #[h4.text-uppercase.font-weight-bold #{order.id}] 
            .col-md-4
              .order__detail.mb-2.text-center
                p.mb-1.order__part--title FROM #[h4.font-weight-bold #{order.sender.username}]
            .col-md-4
              .order__detail.mb-2.text-center
                p.mb-1.order__part--title TO #[h4.font-weight-bold #{order.patient}]
        .card.mt-4
          .card-body
            .card-title 
              p.order__part--title.text-uppercase Order Information  
            ul.mt-3.list-group
            each product, index in products
              li.list-group-item.d-flex.justify-content-between.align-items-center
                h5.mb-1 #{product.item.name}
                div.h6
                  span.badge.badge-secondary.mr-3 x#{product.qty}
                  span.text-info.m-0 #{displayPrices[index]}

            .float-right.mt-3.text-right
              //- h6.text-muted No. of Items: #{totalQty}
              //- h3.mt-1 Total: #[span.text-success #{totalPrice}]
              .order__detail.mb-2
                p.mb-1.order__part--title TOTAL 
                h1.text-success #{totalPrice}

              if order.active && !session.verified
                form(method="POST" action="/orders/sender/verify")
                  input(type='', name='orderID', value = order.id hidden)
                  input(type='', name='senderID', value = order.sender.id hidden)
                  .input-group
                    input.form-control.input-sm(type='password', name='pin', pattern='[0-9]{4}', id="pin", maxlength='4', placeholder= order.sender.username + "'s Pin Here...", aria-describedBy="#pinHelp" required)
                    .input-group-append
                      input.btn.btn-primary.btn-sm(type='submit', value='Verify')
                  small#upriceHelp.form-text.text-danger *4-digit pin is required
              else if order.active && session.verified == true
                a.btn.btn-block.btn-lg.btn-outline-success(href=`/orders/${order.id}/checkout`) Dispense
                //- button.btn.btn-lg.btn-success.btn-block.openPinModal(type='button', data-toggle='modal', data-target='#pinModal', data-order=`${order.id}`) Dispense


  //- #pinModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='cartModalTitle', aria-hidden='true')
  //-   .modal-dialog.modal-dialog-centered(role='document')
  //-     .modal-content
  //-       .modal-header
  //-         h3#cartModalTitle.modal-title Enter Pin
  //-         button.close(type='button', data-dismiss='modal', aria-label='Close')
  //-           span(aria-hidden='true') &times;
  //-       .modal-body
  //-         form(method="GET")
  //-           .input-group
  //-             input.form-control.input-sm(type='password', name='pin', pattern='[0-9]{4}', maxlength='4')
  //-             .input-group-append
  //-               input.btn.btn-info.btn-sm(type='submit', value='Validate')
  //-       .modal-footer
  //-         button.btn.btn-secondary(type='button', data-dismiss='modal') Cancel
  //-         a.btn.btn-block.btn-lg.btn-outline-success(href=`/orders/${order.id}/checkout`) Dispense


          //- form#prodSearchForm
          //-     input.form-control.col-3.form-control-lg#prodSearch(type="text", placeholder="Search for products")

          //- ul.mt-3.list-group#productList

          //-     each product, index in products
          //-         if product.unit == 'pack'
          //-             -var unit =  `pack of ${product. unitq}`;
          //-         else
          //-             -var unit = `${product.unit}`;

          //-         li.list-group-item.d-flex.justify-content-between.align-items-center.product
          //-             //- h3 #{product.name} as #{product.unit}  #{product.unitq ? "of " + product.unitq : ""}
          //-             .container-fluid
          //-                 h4 #{product.name}
          //-                 h6.text-success
          //-                     span #{displayPrices[index]} #[small.text-muted /#{unit}]

          //-             if product.quantity > 0
          //-                 if product.quantity <= product.reorder
          //-                     span.mr-3.badge.badge-warning.badge-lg  #{product.quantity} in stock
          //-                 else
          //-                     span.mr-3.badge.badge-success.badge-lg #{product.quantity} in stock

          //-                 a.btn.btn-primary.mr-3(href=`/cart/new/${product.id}`) Add to Cart
          //-             else
          //-                 span.mr-3.badge.badge-danger.badge-pill None Available
